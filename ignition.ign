{"ignition":{"config":{},"security":{"tls":{}},"timeouts":{},"version":"2.3.0"},"networkd":{},"passwd":{"users":[{"name":"core","passwordHash":"$6$rounds=4096$yvhf4.cTMC$MZvJr.QHo3HcLHZE.9ZKoF1SzVHO1a/q6Hu5.frx7EiJGCJWBwe76sTnVeQh1jn.M/bOGA0aVyJrvmAmH.UA40"}]},"storage":{"files":[{"filesystem":"root","path":"/etc/flatcar/update.conf","contents":{"source":"data:,SERVER%3Ddisabled","verification":{}},"mode":420},{"filesystem":"root","path":"/etc/hostname","contents":{"source":"data:,flatcar-development","verification":{}},"mode":420},{"filesystem":"root","path":"/opt/k3s-install.sh","contents":{"source":"https://get.k3s.io","verification":{}},"mode":777},{"filesystem":"root","path":"/opt/helm-install.sh","contents":{"source":"https://raw.githubusercontent.com/helm/helm/master/scripts/get-helm-3","verification":{}},"mode":777},{"filesystem":"root","path":"/opt/umh-install.sh","contents":{"source":"data:,%23!%2Fbin%2Fsh%0Aecho%20%22Installing%20the%20United%20Manufacturing%20Hub.%20This%20might%20take%20a%20while...%22%0A%0Aecho%20%22Adding%20helm%20repo...%22%0Aif%20!%20helm%20repo%20add%20united-manufacturing-hub%20https%3A%2F%2Frepo.umh.app%2F%3B%20then%0Aecho%20%22Failed%20to%20add%20umh%20repository%2C%20aborting%20setup%22%0Aexit%0Afi%0Aecho%20%22Added%20helm%20repo!%22%0A%0Aecho%20%22Creating%20namespace%20united-manufacturing-hub...%22%0Aif%20!%20kubectl%20create%20namespace%20united-manufacturing-hub%3B%20then%0Aecho%20%22Failed%20to%20create%20kubernetes%20namespace%20for%20united-manufacturing-hub%2C%20aborting%20setup%22%0Aexit%0Afi%0Aecho%20%22Created%20namespace!%22%0A%0Aecho%20%22Install%20Helm%20chart%20united-manufacturing-hub...%22%0Aif%20!%20helm%20install%20united-manufacturing-hub%20united-manufacturing-hub%2Funited-manufacturing-hub%20--set%20serialNumber%3D%24(hostname)%20--kubeconfig%20%2Fetc%2Francher%2Fk3s%2Fk3s.yaml%20-n%20united-manufacturing-hub%3B%20then%0Aecho%20%22Failed%20to%20install%20united-manufacturing-hub%20using%20helm%2C%20aborting%20setup%22%0Aexit%0Afi%0Aecho%20%22Installed%20Helm%20chart!%22%0A%0Atouch%20%2Fopt%2FDO_NOT_DELETE_UMH_IS_INSTALLED%0A%0Aecho%20%22United%20Manufacturing%20Hub%20successfully%20installed!%20However%2C%20it%20might%20take%20a%20couple%20of%20minutes%20until%20all%20services%20are%20successfully%20started%20up.%22","verification":{}},"mode":777}]},"systemd":{"units":[{"contents":"[Unit]\nDescription=Setups opt-modules folder and downloads sound modules\nAfter=local-fs.target\nConditionPathExists=!/opt/modules\n[Service]\nType=forking\nTimeoutStartSec=180\nRemainAfterExit=yes\nKillMode=process\nEnvironment=\"modules=/opt/modules\"\nExecStart=/usr/bin/sh -c \"sudo mkdir -p \"${modules}\" \"${modules}.wd\" \u0026\u0026 sudo mount -o \"lowerdir=/usr/lib64/modules,upperdir=${modules},workdir=${modules}.wd\" -t overlay overlay /usr/lib64/modules \u0026\u0026 cd /usr/lib64/modules/5.15.63-flatcar \u0026\u0026 sudo wget https://github.com/JeremyTheocharis/flatcar-snd-usb-audio/raw/main/snd-usb-audio.tar.gz \u0026\u0026 sudo tar -xvf snd-usb-audio.tar.gz \u0026\u0026 sudo rm snd-usb-audio.tar.gz \u0026\u0026 sudo mv sound-build/ sound/ \u0026\u0026 sudo depmod \u0026\u0026 sudo modprobe snd-usb-audio\"\n[Install]\nWantedBy=multi-user.target\n","enabled":true,"name":"sound-module-init.service"},{"contents":"[Unit]\nDescription=Mounts /opt/modules folder and load sound module into kernel\nAfter=local-fs.target\nConditionPathExists=/opt/modules\n[Service]\nType=forking\nTimeoutStartSec=180\nRemainAfterExit=yes\nKillMode=process\nEnvironment=\"modules=/opt/modules\"\nExecStart=/usr/bin/sh -c \"sudo mount -o \"lowerdir=/usr/lib64/modules,upperdir=${modules},workdir=${modules}.wd\" -t overlay overlay /usr/lib64/modules \u0026\u0026 sudo depmod \u0026\u0026 sudo modprobe snd-usb-audio\"\n[Install]\nWantedBy=multi-user.target\n","enabled":true,"name":"sound-module-startup.service"},{"contents":"[Unit]\nDescription=Run K3s script\nWants = network-online.target\nAfter = network.target network-online.target        \nConditionPathExists=/opt/k3s-install.sh\nConditionPathExists=!/opt/bin/k3s\n[Service]\nType=forking\nTimeoutStartSec=180\nRemainAfterExit=yes\nKillMode=process\nEnvironment=\"INSTALL_K3S_EXEC=--cluster-init\"\nExecStart=/usr/bin/sh -c \"/opt/k3s-install.sh\"\n[Install]\nWantedBy=multi-user.target      \n","enabled":true,"name":"k3s-install.service"},{"contents":"[Unit]\nDescription=Run Helm installation script\nWants = network-online.target k3s-install.service \nAfter = network.target network-online.target k3s-install.service       \nConditionPathExists=/opt/helm-install.sh\nConditionPathExists=!/opt/bin/helm\n[Service]\nType=forking\nTimeoutStartSec=180\nRemainAfterExit=yes\nKillMode=process\nEnvironment=\"HELM_INSTALL_DIR=/opt/bin\"\nExecStart=/usr/bin/sh -c \"PATH=$PATH:/opt/bin \u0026\u0026 /opt/helm-install.sh\"\n[Install]\nWantedBy=multi-user.target  \n","enabled":true,"name":"helm-install.service"},{"contents":"[Unit]\nDescription=Run UMH installation script\nWants = network-online.target k3s-install.service helm-install.service\nAfter = network.target network-online.target k3s-install.service helm-install.service  \nConditionPathExists=/opt/umh-install.sh\nConditionPathExists=!/opt/DO_NOT_DELETE_UMH_IS_INSTALLED\n[Service]\nType=forking\nTimeoutStartSec=180\nRemainAfterExit=yes\nKillMode=process\nEnvironment=\"\"\nExecStart=/usr/bin/sh -c \"PATH=$PATH:/opt/bin \u0026\u0026 /opt/umh-install.sh\"\n[Install]\nWantedBy=multi-user.target  \n","enabled":true,"name":"umh-install.service"}]}}